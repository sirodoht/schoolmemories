{% extends 'main/layout.html' %}

{% block title %}Submit a memory{% endblock %}

{% block content %}

{% include 'partials/nav.html' %}

<main id="memory-create">
    <div class="memory-submission-container">
        <header class="memory-submission-header">
            <h1>Submit a memory</h1>
        </header>

        <form method="post" class="memory-submission-form">
            {{ form.non_field_errors }}

            <div class="form-section">
                <h2 class="section-title">About You (when your memory occurred)</h2>
                <p class="section-helptext">The information below is used to contextualize your memory.</p>

                <div class="form-field">
                    <p style="font-size: 17px; line-height: 1.8;">
                        The memory happened when I was
                        <span style="display: inline-block; min-width: 80px;">
                            {{ form.age.errors }}
                            {{ form.age }}
                        </span>
                        years old, when I self-identified as
                        <span style="display: inline-block; min-width: 150px;">
                            {{ form.gender.errors }}
                            {{ form.gender }}
                        </span>
                    </p>
                </div>

                <div class="form-field" id="gender_other_field" style="display: none; margin-top: 12px;">
                    <span class="helptext">
                        Please type how you would like to self describe in whatever identity terms are most
                        salient to you.
                    </span>
                    {{ form.gender_other.errors }}
                    {{ form.gender_other }}
                </div>

                <div class="form-field" style="margin-top: 20px;">
                    <p style="font-size: 17px; line-height: 1.8; margin-bottom: 8px;">
                        At the time I used to describe myself as:
                    </p>
                    <span class="helptext">
                        Fill out the heritage that best describes you at the time of your memory,
                        e.g. Greek, Catholic Northern-Irish, Urban Indigenous Peoples etc.
                    </span>
                    {{ form.heritage.errors }}
                    {{ form.heritage }}
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">About your school context</h2>
                <p class="section-helptext">
                    Some of the provided options are more relevant to the UK context but you can add what best
                    corresponds to your case by typing in the respective field. Otherwise, please type N/A.
                    The options provided have been designed to be as generic as possible but may not fit every
                    country's context. If you can't fit your memory into one of the existing categories,
                    please specify the school type that best applies to your case.
                </p>

                <div class="form-field">
                    <span class="helptext">
                        Please type your city/town/village and select the country where your memory took place.
                    </span>
                    <p style="font-size: 17px; line-height: 1.8; margin-bottom: 12px;">
                        Back then, I lived in
                        <span style="display: inline-block; min-width: 200px;">
                            {{ form.location.errors }}
                            {{ form.location }}
                        </span>
                        in
                        <span style="display: inline-block; min-width: 200px; max-width: 360px;">
                            {{ form.country.errors }}
                            {{ form.country }}
                        </span>
                    </p>
                </div>

                <div class="form-field" style="margin-top: 20px;">
                    <span class="helptext">
                        Please indicate the educational grade your memory refers to.
                    </span>
                    <p style="font-size: 17px; line-height: 1.8; margin-bottom: 12px;">
                        My memory occurred in grade
                        <span style="display: inline-block; min-width: 150px;">
                            {{ form.school_grade.errors }}
                            {{ form.school_grade }}
                        </span>
                    </p>
                </div>

                <div class="form-field" style="margin-top: 20px;">
                    <p style="font-size: 17px; line-height: 1.8; margin-bottom: 12px;">
                        The school I went to was funded by
                        <span style="display: inline-block; min-width: 200px;">
                            {{ form.school_funding.errors }}
                            {{ form.school_funding }}
                        </span>
                    </p>
                </div>

                <div class="form-field" id="school_funding_other_field" style="display: none; margin-top: 12px;">
                    <span class="helptext">
                        Please specify the funding type.
                    </span>
                    {{ form.school_funding_other.errors }}
                    {{ form.school_funding_other }}
                </div>

                <div class="form-field" style="margin-top: 24px;">
                    <p style="font-size: 17px; line-height: 1.8; margin-bottom: 8px;">
                        <strong>Other details about my school include:</strong>
                    </p>
                    <p style="font-size: 16px; margin-bottom: 8px;">It was a:</p>
                    <span class="helptext">
                        Choose the educational philosophies that best describe your school (you can select multiple).
                        If you choose 'other', please write down your answer in the text box below.
                    </span>
                    {{ form.educational_philosophy.errors }}
                    {{ form.educational_philosophy }}
                </div>

                <div class="form-field" id="educational_philosophy_other_field" style="display: none; margin-top: 12px;">
                    <span class="helptext">
                        Please specify the educational philosophy.
                    </span>
                    {{ form.educational_philosophy_other.errors }}
                    {{ form.educational_philosophy_other }}
                </div>

                <div class="form-field" style="margin-top: 20px;">
                    <p style="font-size: 16px; margin-bottom: 8px;">Religious/Spiritual Tradition (optional):</p>
                    <span class="helptext">
                        Choose the religious/spiritual tradition that describes your school.
                    </span>
                    {{ form.religious_tradition.errors }}
                    {{ form.religious_tradition }}
                </div>

                <div class="form-field" id="religious_tradition_other_field" style="display: none; margin-top: 12px;">
                    <span class="helptext">
                        Please specify the religious/spiritual tradition.
                    </span>
                    {{ form.religious_tradition_other.errors }}
                    {{ form.religious_tradition_other }}
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Your Memory</h2>

                <div class="form-field">
                    <label for="id_memory_themes">Memory Themes <span class="required">*</span></label>
                    <span class="helptext">
                        Please choose one or more themes that you believe best reflect your memory's content.
                        The examples below come from research conducted with children and young people living and 
                        studying in the UK between 2019 and 2023 and you can read more about it in the
                        <a href="/about/">About</a> page. Additionally, you can type your own
                        themes (up to 5) in the dedicated field below, separated by semicolons.
                    </span>
                    {{ form.memory_themes.errors }}
                    {{ form.memory_themes }}
                </div>

                <div class="form-field">
                    <label for="id_memory_themes_additional">Additional Memory Themes</label>
                    <span class="helptext">
                        Enter up to 5 custom themes separated by semicolons (;)
                    </span>
                    {{ form.memory_themes_additional.errors }}
                    {{ form.memory_themes_additional }}
                </div>

                <div class="form-field">
                    <label for="id_title">Title <span class="required">*</span></label>
                    <span class="helptext">
                        Here you can give a title to your memory.
                    </span>
                    {{ form.title.errors }}
                    {{ form.title }}
                </div>

                <div class="form-field">
                    <label for="id_body">The Memory (max 1000 words) <span class="required">*</span></label>
                    <span class="helptext">
                        Here you can type your selected school memory in as much detail as you want but
                        without naming anyone involved. Some prompts to assist your writing might
                        include questions like: What happens in your school memory? How did it make you
                        feel? Where did it take place, when, and who else was involved? Was it a
                        recurring or one-off event? Can you recall any images, smells or sensations? Why
                        do you think this memory can make possible just futures of education?
                    </span>
                    {{ form.body.errors }}
                    {{ form.body }}
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Agreements & Confirmation</h2>

                <div class="agreement-field">
                    {{ form.terms_of_service.errors }}
                    <label for="id_terms_of_service" style="margin-bottom: 0;">
                        {{ form.terms_of_service }}
                        <span>
                            I agree with the <a href="{% url 'terms_of_service' %}" target="_blank">Terms of Service</a>
                            <small>(opens in a new tab)</small> <span class="required">*</span>
                        </span>
                    </label>
                </div>

                <div class="agreement-field">
                    {{ form.privacy_policy.errors }}
                    <label for="id_privacy_policy" style="margin-bottom: 0;">
                        {{ form.privacy_policy }}
                        <span>
                            I agree with the <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>
                            <small>(opens in a new tab)</small> <span class="required">*</span>
                        </span>
                    </label>
                </div>

                <div class="agreement-field">
                    {{ form.age_confirmation.errors }}
                    <label for="id_age_confirmation" style="margin-bottom: 0;">
                        {{ form.age_confirmation }}
                        <span>
                            I confirm I am over 18 years old <span class="required">*</span>
                        </span>
                    </label>
                </div>
            </div>

            {% if enable_turnstile %}
            <div class="form-section">
                <div class="cf-turnstile" data-sitekey="0x4AAAAAABM4uMpeJqzaXTok" data-callback="turnstileCallback"></div>
                <input type="hidden" name="turnstile_response" id="id_turnstile_response">
            </div>
            {% endif %}

            {% csrf_token %}

            <div class="form-submit">
                <input type="submit" value="Submit memory" class="submit-button">
            </div>
        </form>
    </div>
</main>
{% endblock content %}

{% block scripts %}

{% if enable_turnstile %}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script>
    function turnstileCallback(token) {
        document.getElementById('id_turnstile_response').value = token;
    }
</script>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Handle gender other field
        const genderSelect = document.getElementById('id_gender');
        const genderOtherField = document.getElementById('gender_other_field');
        const genderOtherInput = document.getElementById('id_gender_other');

        function toggleGenderOtherField() {
            if (genderSelect.value === 'OTHER') {
                genderOtherField.style.display = 'block';
                genderOtherInput.required = true;
            } else {
                genderOtherField.style.display = 'none';
                genderOtherInput.required = false;
                genderOtherInput.value = '';
            }
        }
        toggleGenderOtherField();
        genderSelect.addEventListener('change', toggleGenderOtherField);

        // Handle school funding other field
        const schoolFundingSelect = document.getElementById('id_school_funding');
        const schoolFundingOtherField = document.getElementById('school_funding_other_field');
        const schoolFundingOtherInput = document.getElementById('id_school_funding_other');

        function toggleSchoolFundingOtherField() {
            if (schoolFundingSelect.value === 'OTHER') {
                schoolFundingOtherField.style.display = 'block';
                schoolFundingOtherInput.required = true;
            } else {
                schoolFundingOtherField.style.display = 'none';
                schoolFundingOtherInput.required = false;
                schoolFundingOtherInput.value = '';
            }
        }
        toggleSchoolFundingOtherField();
        schoolFundingSelect.addEventListener('change', toggleSchoolFundingOtherField);

        // Handle educational philosophy other field
        const educationalPhilosophyCheckboxes = document.querySelectorAll('input[name="educational_philosophy"]');
        const educationalPhilosophyOtherField = document.getElementById('educational_philosophy_other_field');
        const educationalPhilosophyOtherInput = document.getElementById('id_educational_philosophy_other');

        function toggleEducationalPhilosophyOtherField() {
            let otherSelected = false;
            educationalPhilosophyCheckboxes.forEach(function(checkbox) {
                if (checkbox.value === 'OTHER' && checkbox.checked) {
                    otherSelected = true;
                }
            });
            if (otherSelected) {
                educationalPhilosophyOtherField.style.display = 'block';
                educationalPhilosophyOtherInput.required = true;
            } else {
                educationalPhilosophyOtherField.style.display = 'none';
                educationalPhilosophyOtherInput.required = false;
                educationalPhilosophyOtherInput.value = '';
            }
        }
        toggleEducationalPhilosophyOtherField();
        educationalPhilosophyCheckboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', toggleEducationalPhilosophyOtherField);
        });

        // Handle religious tradition other field
        const religiousTraditionSelect = document.getElementById('id_religious_tradition');
        const religiousTraditionOtherField = document.getElementById('religious_tradition_other_field');
        const religiousTraditionOtherInput = document.getElementById('id_religious_tradition_other');

        function toggleReligiousTraditionOtherField() {
            if (religiousTraditionSelect.value === 'OTHER') {
                religiousTraditionOtherField.style.display = 'block';
                religiousTraditionOtherInput.required = true;
            } else {
                religiousTraditionOtherField.style.display = 'none';
                religiousTraditionOtherInput.required = false;
                religiousTraditionOtherInput.value = '';
            }
        }
        toggleReligiousTraditionOtherField();
        religiousTraditionSelect.addEventListener('change', toggleReligiousTraditionOtherField);
    });
</script>
{% endblock scripts %}
