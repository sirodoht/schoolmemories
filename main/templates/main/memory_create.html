{% extends 'main/layout.html' %}

{% block title %}Submit a memory{% endblock %}

{% block content %}

{% include 'partials/nav.html' %}

<main>
    <div style="max-width: 800px;">
        <h1>Submit a memory</h1>
        <form method="post">
            {{ form.non_field_errors }}

            <p>
                <label for="id_gender">Gender <span style="color: red;">*</span></label>
                {{ form.gender.errors }}
                {{ form.gender }}
            </p>

            <p>
                <label for="id_ethnicity">Racial and/or Ethnic background <span style="color: red;">*</span></label>
                {{ form.ethnicity.errors }}
                {{ form.ethnicity }}
                <span class="helptext">
                    Please type how you prefer to self-describe. Otherwise, type N/A.
                </span>
            </p>

            <p>
                <label for="id_country">Location <span style="color: red;">*</span></label>
                {{ form.country.errors }}
                {{ form.country }}
                <span class="helptext">
                    <br>Please indicate the country in which your memory took place.
                </span>
            </p>

            <p>
                <label for="id_school_grade">School Grade <span style="color: red;">*</span></label>
                {{ form.school_grade.errors }}
                {{ form.school_grade }}
                <span class="helptext">
                    Please indicate the educational grade your memory refers to.
                </span>
            </p>

            <p>
                <label for="id_school_type">School Type <span style="color: red;">*</span></label>
                {{ form.school_type.errors }}
                {{ form.school_type }}
                <span class="helptext">
                    <br>Please indicate the school type your memory refers to. The provided options
                    are more relevant to the UK context but you can add what best corresponds to
                    your case by typing in the respective field. Otherwise, please type N/A.
                </span>
            </p>

            <p id="school_type_other_field" style="display: none;">
                <label for="id_school_type_other">Please specify other school type <span
                        style="color: red;">*</span></label>
                {{ form.school_type_other.errors }}
                {{ form.school_type_other }}
                <span class="helptext">
                    Please describe the school type that best corresponds to your case.
                </span>
            </p>

            <div>
                <label for="id_memory_themes">Memory Themes <span style="color: red;">*</span></label>
                <span class="helptext">
                    Please choose one or more themes that you believe best reflect your memory's content.
                    Additionally, you can type your own themes (up to 5) in the dedicated field below,
                    separated by semicolons.
                </span>
                {{ form.memory_themes.errors }}
                {{ form.memory_themes }}
            </div>

            <p>
                <label for="id_memory_themes_additional">Additional Memory Themes</label>
                {{ form.memory_themes_additional.errors }}
                {{ form.memory_themes_additional }}
                <span class="helptext">
                    Enter up to 5 custom themes separated by semicolons (;)
                </span>
            </p>

            <p>
                <label for="id_title">Title <span style="color: red;">*</span></label>
                {{ form.title.errors }}
                {{ form.title }}
                <span class="helptext">
                    Here you can give a title to your memory.
                </span>
            </p>

            <p>
                <label for="id_body">Memory content (max 300 words) <span style="color: red;">*</span></label>
                {{ form.body.errors }}
                {{ form.body }}
                <span class="helptext">
                    Here you can type your selected school memory in as much
                    detail as you want but without naming anyone involved. Some
                    prompts to assist your writing might include questions like:
                    What happens in your school memory? How did it make you
                    feel? Where did it take place, when, and who else was
                    involved? Was it a recurring or one-off event? Can you
                    recall any images, smells or sensations? Why do you think
                    this memory can make possible just futures of education?
                </span>
            </p>

            <p>
                <label for="id_terms_of_service">
                    I agree with the <a href="{% url 'terms_of_service' %}" target="_blank">Terms of Service</a>
                    <small>(open in a new tab)</small> <span style="color: red;">*</span>
                </label>
                {{ form.terms_of_service.errors }}
                {{ form.terms_of_service }}
            </p>

            <p>
                <label for="id_privacy_policy">
                    I agree with the <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>
                    <small>(open in a new tab)</small> <span style="color: red;">*</span>
                </label>
                {{ form.privacy_policy.errors }}
                {{ form.privacy_policy }}
            </p>

            {% csrf_token %}

            {% if enable_turnstile %}
            <div class="cf-turnstile" data-sitekey="0x4AAAAAABM4uMpeJqzaXTok" data-callback="turnstileCallback"
                style="margin-bottom: 12px;"></div>
            <input type="hidden" name="turnstile_response" id="id_turnstile_response">
            {% endif %}

            <input type="submit" value="Submit memory">
        </form>
    </div>
</main>
{% endblock content %}

{% block scripts %}

{% if enable_turnstile %}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script>
    function turnstileCallback(token) {
        document.getElementById('id_turnstile_response').value = token;
    }
</script>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const schoolTypeSelect = document.getElementById('id_school_type');
        const schoolTypeOtherField = document.getElementById('school_type_other_field');
        const schoolTypeOtherInput = document.getElementById('id_school_type_other');
        function toggleOtherField() {
            if (schoolTypeSelect.value === 'OTHER') {
                schoolTypeOtherField.style.display = 'block';
                schoolTypeOtherInput.required = true;
            } else {
                schoolTypeOtherField.style.display = 'none';
                schoolTypeOtherInput.required = false;
                schoolTypeOtherInput.value = '';
            }
        }
        toggleOtherField();
        schoolTypeSelect.addEventListener('change', toggleOtherField);
    });
</script>
{% endblock scripts %}
